### 使用Deepseek Reasoner模型流程

1. 用户选择DeepSeek Reasoner模型

- 前端UI: 点击模型选择按钮 → 选择DeepSeek Reasoner选项

- 前端JS处理: 更新currentModel = "deepseek-r1"

- 模型切换提示: 显示已切换为DeepSeek Reasoner的消息



2. 用户输入问题并发送

- 用户在输入框输入: "计算9.11和9.8哪个大?"

- 前端处理:

- 添加用户消息到UI

- 清空输入框

- 显示"思考中..."加载提示

- 创建EventSource连接: /ai-chat/api/chat/stream?message=计算9.11和9.8哪个大?&modelType=deepseek-r1



3. 后端路由到DeepseekR1ModelService

- 控制器: ChatController.chatStream()接收请求

- 服务选择: AIChatServiceImpl.getModelService("deepseek-r1") 返回deepseekR1ModelService

- 调用服务方法: deepseekR1ModelService.generateStreamResponse(message, emitter)



4. DeepSeek API调用

- 构建API请求:

  ```java
       JSONObject requestBody = new JSONObject();
       requestBody.put("model", modelName); // deepseek-reasoner
       requestBody.put("stream", true);
       // ... 其他参数设置
  ```

  

- 发送异步请求到DeepSeek API端点: https://api.deepseek.com/v1/chat/completions



5. 接收思维链和回答

- DeepSeek API返回流式数据

- 后端处理:

- 解析思维链部分: delta.has("reasoning_content")

- 发送思维链事件: emitter.send(SseEmitter.event().name("reasoning").data(reasoning))

- 解析最终回答: delta.has("content")

- 发送内容事件: emitter.send(SseEmitter.event().name("content").data(content))



6. 前端渲染思维链和回答

- 接收思维链事件: eventSource.addEventListener('reasoning', function(event) {...}

- 接收内容事件: eventSource.addEventListener('content', function(event) {...}

- 分别渲染到UI上的不同区域

- 可提供思维链显示/隐藏切换功能



7. 完成处理

- 后端发送完成事件: emitter.send(SseEmitter.event().name("complete").data(completeData.toString()))

- 后端关闭SSE发射器: emitter.complete()

- 前端接收完成事件，更新最终统计信息

- 前端关闭EventSource连接: eventSource.close()



8. 用户可继续对话

- 界面准备好接收下一条输入

- 整个对话历史保留在页面上